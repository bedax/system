#!/usr/bin/env python3

import re
import subprocess
from pathlib import PurePath



def command(command):
   return subprocess.check_output(command).strip().decode("utf-8")


def find(regex, string):
   match = re.search(regex, string)
   return match.group(1)


def get_window_id():
   return command(["xdotool", "getactivewindow"])


def get_window_class(wid):
   class_line = command(["xprop", "-id", wid, "WM_CLASS"])
   return find(r'", "(.+)"$', class_line)


def get_window_title(wid):
   return command(["xdotool", "getwindowname", wid])


# takes for form of
# executable  /path/to/somewhere
def get_path_from_st(title):
   return title.split("  ")[-1]


# takes the form of:
# Untitled - Textadept (Untitled)
# file.sh - Textadept (/path/to/file.sh)
def get_path_from_textadept(title):
   path = find(r"\((.+)\)$", title)
   return None if path == "Untitled" else PurePath(path).parent


# takes the form of:
# /path/to/somewhere - File Manager
def get_path_from_thunar(title):
   return find(r"(.+) - File Manager$", title)


def main():
   wid = get_window_id()
   class_name = get_window_class(wid)
   title = get_window_title(wid)

   if class_name == "st-256color":
      path = get_path_from_st(title)
   elif class_name == "Textadept":
      path = get_path_from_textadept(title)
   elif class_name == "Thunar":
      path = get_path_from_thunar(title)
   else:
      path = None

   if path:
      print(path)



main()
