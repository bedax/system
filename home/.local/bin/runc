#!/bin/sh

if [ -z "$CC" ]; then
	CC="cc -std=c89"
fi

if [ -z "$CFLAGS" ]; then
	CFLAGS="-Wall -Wextra -pedantic"
fi

OUT="$(mktemp)"
EXTRA_CFLAGS="-fdiagnostics-color=always $EXTRA_CFLAGS"
OUTPUT=$($CC $CFLAGS $EXTRA_CFLAGS -o "$OUT" "$1" 2>&1)
ret=$?

clear
echo "$OUTPUT" | less --RAW-CONTROL-CHARS --quit-if-one-screen --no-init

if [ $ret -eq 0 ]; then
	echo
	shift
	chmod +x "$OUT"
	"$OUT" "$@"
fi

rm -f "$OUT"
